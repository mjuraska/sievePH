% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/kernel_sievePH.R
\name{kernel_sievePH}
\alias{kernel_sievePH}
\title{Nonparametric Kernel-Smoothed Stratified Mark-Specific Proportional Hazards
Model with a Univariate Continuous Mark, Missing-at-Random in Some Failures}
\usage{
kernel_sievePH(
  eventTime,
  eventInd,
  mark,
  tx,
  aux = NULL,
  strata = NULL,
  nboot = 500,
  missmethod,
  formulaMiss = NULL,
  tau,
  tband,
  hband,
  a,
  b,
  ntgrid = 100,
  nvgrid = 100,
  confLevel = 0.95,
  seed = 62648
)
}
\arguments{
\item{eventTime}{a numeric vector specifying the observed right-censored
event time.}

\item{eventInd}{a numeric vector indicating the event of interest (1 if
event, 0 if right-censored).}

\item{mark}{a numeric vector specifying a univariate continuous mark subject
to missingness at random. Missing mark values should be set to \code{NA}.
For subjects with \code{eventInd = 0}, the value in \code{mark} should also
be set to \code{NA}.}

\item{tx}{a numeric vector indicating the treatment group (1 if treatment, 0
if placebo).}

\item{aux}{a numeric vector specifying a binary auxiliary covariate
predictive of the probability of observing the mark or the value of the
mark The mark missingness model only requires that the auxiliary covariates
be observed in subjects who experienced the event of interest. For subjects
with \code{eventInd = 0}, the value in \code{aux} may be set to \code{NA}.
If no auxiliary covariate is used, \code{aux} should be set to the default
value of \code{NULL}.}

\item{strata}{a numeric vector specifying baseline strata (\code{NULL} by
default). If specified, a separate mark-specific baseline hazard is assumed
for each stratum. If either an IPW or AIPW method is used, a separate
logistic regression model for predicting the probability of a missing mark
and a separate model for predicting the mark are considered witin each
stratum.}

\item{nboot}{number of bootstrap iterations for simulating the distribution
of test statistics for testing \eqn{H_{10}} vs. \eqn{H_{1a}} or
\eqn{H_{1m}} and \eqn{H_{20}} vs. \eqn{H_{2a}} or \eqn{H_{2m}}.}

\item{missmethod}{a character string for the estimation procedure to use.
Available missing-mark methods include \code{CC}, \code{IPW}, and
\code{AIPW}.}

\item{formulaMiss}{a one-sided formula object specifying (on the right side
of the \code{~} operator) the linear predictor in the logistic regression
model used for predicting the probability of observing the mark. Available
variables to be used in the formula include \code{eventTime}, \code{tx},
and \code{aux} (must not have NAs if used). \code{formulaMiss} (\code{NULL}
by default) must be provided for \code{IPW} and \code{AIPW} methods.}

\item{tau}{a numeric value specifying the end of the follow-up period for
conducting the analysis.}

\item{tband}{a numeric value between 0 and \code{tau} specifying the
bandwidth of the kernel smoothing function over the failure time.}

\item{hband}{a numeric value between 0 and 1 specifying the bandwidth of the
kernel smoothing function over the mark. Larger bandwidths are recommended
for higher percentages of missing marks.}

\item{a}{a numeric value between 0 and 1 specifying the lower bound of the
range for testing the null hypothesis \deqn{H_{10}: HR(v) = 1} for v
\eqn{\in [a, b]}; \code{a} needs to be \code{1/nvgrid} multiplied by an
integer.}

\item{b}{a numeric value between 0 and 1 specifying the upper bound of the
range for testing the null hypothesis \deqn{H_{10}: HR(v) = 1} for v
\eqn{\in [a, b]}; \code{b} needs to be \code{1/nvgrid} multiplied by an
integer.}

\item{ntgrid}{an integer value specifying the number of equally spaced time
points for which the mark-specific baseline hazard functions are evaluated.}

\item{nvgrid}{an integer value specifying the number of equally spaced mark
values between the minimum and maximum of the observed mark values for
which the treatment effects are evaluated.}

\item{confLevel}{the confidence level (0.95 by default) of reported
confidence intervals.}

\item{seed}{an integer specifying the random number generation seed for
reproducing the test statistics and p-values.}
}
\value{
A list containing the following components:
\itemize{
\item \code{H10}: a data frame with test statistics (first row) and
corresponding p-values (second row) for testing \deqn{H_{10}: HR(v) = 1} for
v \eqn{\in [a, b]}. The test statistics are calculated for mark values in
\eqn{[a1, b]}, where \eqn{a1 = a + (b-a)/nvgrid}. Columns \code{TSUP1} and
\code{Tint1} include test statistics and p-values for testing \deqn{H_{10}}
vs. \deqn{H_{1a}: HR(v) != 1} for any v \eqn{\in [a, b]} (general
alternative). Columns \code{TSUP1m} and \code{Tint1m} include test statistics
and p-values for testing \deqn{H_{10}} vs. \deqn{H_{1m}: HR(v) <= 1} with
strict inequality for some v \eqn{\in [a, b]} (monotone alternative). Columns
\code{TSUP1} and \code{TSUP1m} are for tests based on extensions of
Kolmogorov-Smirnov tests. Columns \code{Tint1} and \code{Tint1m} are for
tests based on generalizations of Cramer-von Mises tests--integration-based
tests.

\item \code{H20}: a data frame with test statistics (first row) and
corresponding p-values (second row) for testing \deqn{H_{20}}: HR(v) does not
depend on v \eqn{\in [a, b]}. The test statistics are calculated for mark
values in \eqn{[a2, b]}, where \eqn{a2 = a + 3*(b-a)/nvgrid}. Columns
\code{TSUP2} and \code{Tint2} include test statistics and p-values for
testing \deqn{H_{20}} vs. \deqn{H_{2a}}: HR depends on v \eqn{\in [a, b]}
(general alternative). Columns \code{TSUP2m} and \code{Tint2m} include test
statistics and p-values for testing \deqn{H_{20}} vs. \deqn{H_{2m}}: HR
increases as v increases \eqn{\in [a, b]} (monotone alternative). Test 
statistics in columns \code{TSUP2} and \code{TSUP2m} are extensions of the 
classic Kolmogorov-Smirnov supremum-based test statistic for testing the 
goodness of fit of a distribution function. Test statistics in columns 
\code{Tint2} and \code{Tint2m} are generalizations of the integration-based 
Cramer-von Mises test statistic for testing the goodness of fit of a 
distribution function. \code{Tint2} and \code{Tint2m} involve 
integration of deviations over the whole range of the mark.
\item \code{te}: a data frame summarizing point and interval estimates of the
mark-specific treatment efficacy on the grid of mark values defined by
\code{nvgrid}. The confidence level is specified by \code{confLevel}.
\code{te} is based on AIPW estimates.

\item \code{estBeta}: a data frame
summarizing point estimates and standard errors of the mark-specific
coefficients using the complete-case method (\code{betacom} and
\code{secom}), the IPW method (\code{betaipw} and \code{seipw}), and the AIPW
method (\code{betaaug} and \code{seaug}).

\item \code{cBproc1}: a data frame
containing mark values in column \code{Mark}, standardized mark values in
column \code{Standardized mark}, test processes \eqn{Q^{(1)}(v)} for
\code{H10} based on observed data sequence in column \code{Observed} and
independent sets of normal samples in columns \eqn{S1, S2, \cdots,
S_{nboot}}.

\item \code{cBproc2}: a data frame containing mark values in
column \code{Mark}, standardized mark values in column \code{Standardized
mark}, test processes \eqn{Q^{(2)}(v)} for \code{H20} based on observed data
sequence in column \code{Observed} and independent sets of normal samples in
columns \eqn{S1, S2, \cdots, S_{nboot}}.
}
}
\description{
\code{kernel_sievePH} implements estimation methods of Sun and Gilbert
(2012) and hypothesis testing methods of Gilbert and Sun (2015) for a
mark-specific proportional hazards model accommodating that some failures
have a missing mark. The methods allow separate baseline mark-specific hazard
functions for different baseline subgroups. Missing marks are handled via
complete-case, inverse-probability weighting (IPW), or augmented IPW (AIPW)
approaches.
}
\details{
\code{kernel_sievePH} analyzes data from a randomized placebo-controlled
trial that evaluates treatment efficacy for a time-to-event endpoint with a
continuous mark. The parameter of interest is the ratio of the conditional
mark-specific hazard functions (treatment/placebo), which is based on a
stratified mark-specific proportional hazards model. This model assumes no
parametric form for the baseline hazard function nor the treatment effect
across different mark values. For data with missing marks, two estimation
procedures are implemented. The first one uses inverse probability weighting
(IPW) of the complete-case estimator, which leverages auxiliary predictors of
whether the mark is observed, whereas the second one augments the IPW
complete-case estimator with auxiliary predictors of the missing mark value.
}
\examples{
set.seed(20240410)
n <- 200
tx <- rep(0:1, each = n / 2)
tm <- c(rexp(n / 2, 0.2), rexp(n / 2, 0.2 * exp(-0.4)))
cens <- runif(n, 0, 15)
eventTime <- pmin(tm, cens, 3)
eventInd <- as.numeric(tm <= pmin(cens, 3))
mark <- ifelse(eventInd == 1, c(rbeta(n / 2, 2, 1), rbeta(n / 2, 2, 2)), NA)
# a binary auxiliary covariate
A <- sapply(exp(-0.5 - 0.2 * mark) / (1 + exp(-0.5 - 0.2 * mark)),
            function(p){ ifelse(is.na(p), NA, rbinom(1, 1, p)) })
linPred <- -0.8 + 0.4 * tx - 0.2 * A
probs <- exp(linPred) / (1 + exp(linPred))
R <- rep(NA, n)
while (sum(R, na.rm = TRUE) < 10){
 R[eventInd == 1] <- sapply(probs[eventInd == 1],
                            function(p){ rbinom(1, 1, p) })
}
# a missing-at-random mark
mark[eventInd == 1] <- ifelse(R[eventInd == 1] == 1, mark[eventInd == 1], NA)
# AIPW estimation, auxiliary covariate is used (not required)
fitaug <- kernel_sievePH(eventTime, eventInd, mark, tx, A, nboot = 50,
                      missmethod = "AIPW", formulaMiss = ~ eventTime,
                      tau = 3, tband = 0.5, hband = 0.3, a = 0.1, b = 1,
                      ntgrid = 20, nvgrid = 20)
\donttest{
#IPW estimation, no auxiliary covariate is used
fitipw <- kernel_sievePH(eventTime, eventInd, mark, tx, nboot = 50,
                      missmethod = "IPW", formulaMiss = ~ eventTime,
                      tau = 3, tband = 0.5, hband = 0.3, a = 0.1, b = 1,
                      ntgrid = 20, nvgrid = 20)

# complete-case estimation discards rows with a missing mark;
# also, no auxiliary covariate is needed
fitcc <- kernel_sievePH(eventTime, eventInd, mark, tx, nboot = 50,
                      missmethod = "CC", tau = 3, tband = 0.5, hband = 0.3,
                      a = 0.1, b = 1, ntgrid = 20, nvgrid = 20)
}

}
\references{
Gilbert, P. B. and Sun, Y. (2015). Inferences on relative failure rates in
stratified mark-specific proportional hazards models with missing marks, with
application to human immunodeficiency virus vaccine efficacy trials.
\emph{Journal of the Royal Statistical Society Series C: Applied Statistics},
64(1), 49-73.

Sun, Y. and Gilbert, P. B. (2012). Estimation of stratified mark‐specific
proportional hazards models with missing marks. \emph{Scandinavian Journal of
Statistics}, 39(1), 34-52.
}
